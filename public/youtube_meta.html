<!doctype html>
<html lang="en">

<head>
	<!-- ðŸ‘‹ðŸ‘‹ðŸ‘‹ Hello dear code reader, have fun understanding how YT works without ads. -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>YT Minimal Player (Metadata)</title>

	<link rel="dns-prefetch" href="//www.youtube.com">
	<link rel="dns-prefetch" href="//www.youtube-nocookie.com">
	<link rel="preconnect" href="https://www.youtube.com" crossorigin>
	<link rel="preconnect" href="https://www.youtube-nocookie.com" crossorigin>

	<style>
		html, body {
			margin: 0;
			padding: 0;
			width: 25%;
			height: 25%;
			overflow: hidden;
		}

		#player-container {
			width: 25%;
			height: 25%;
			position: fixed;
			top: 0;
			left: 0;
		}
	</style>
</head>

<body>
	<div id="player-container"></div>

	<script>
		function getUrlParameter(name) {
			const urlParams = new URLSearchParams(window.location.search);
			if (urlParams.get(name)) return urlParams.get(name);

			return null;
		}

		const tag = document.createElement('script');
		tag.src = "https://www.youtube.com/iframe_api";
		document.head.appendChild(tag);

		let player = null;

		const defaultPlayerVars = {
			controls: 0,       // Hide native controls
			rel: 0,            // Disable related videos
			loop: 0,           // No loop
			disablekb: 1,      // Disable keyboard shortcuts
			modestbranding: 1, // Reduce branding
			enablejsapi: 1,    // Enable JS API for custom controls
			muted: 1,		   //Set to play muted
			autoplay: 1		   //Set to make it autostart
		};

		function onYouTubeIframeAPIReady() {
			const vid = getUrlParameter('v') || 'dQw4w9WgXcQ';

			createPlayer(vid);
		}

		function createPlayer(videoId) {
			if (player && typeof player.destroy === 'function') {
				player.destroy();
				player = null;
				document.getElementById('player-container').innerHTML = '';
			}

			player = new YT.Player('player-container', {
				height: '100%',
				width: '100%',
				videoId: videoId,
				playerVars: defaultPlayerVars,
				host: 'https://www.youtube-nocookie.com',
				events: {
					onReady: () => {
						player.setVolume(0)
					},
					onStateChange: (event) => {
						if (event.data === YT.PlayerState.PLAYING) {

							const videoData = player.getVideoData()
							const metadata = {
								title: videoData.title,
								isLive: videoData.isLive,
								duration: player.getDuration(),
							};

							console.log("METADATA:" + JSON.stringify(metadata));
						}
					},
					onError: (event) => {
						const YT_ERROR_CODES = {
							2: "Invalid parameter value (e.g. wrong video ID format).",
							5: "HTML5 player error â€“ the requested content cannot be played in this player.",
							100: "Video not found. It may have been removed, set to private, or the ID is invalid.",
							101: "The owner of the video has prohibited embedding on this site.",
							150: "Video is age-restricted or unplayable for unknown reasons." // Same as 101
						};

						console.log("ERROR:" + YT_ERROR_CODES[event.data]);
					}
				}
			});
		}

		/**
		 * Handle edge case if API already loaded
		 */
		if (window.YT && window.YT.Player && !player) {
			setTimeout(() => { onYouTubeIframeAPIReady(); }, 0);
		}

	</script>
</body>

</html>