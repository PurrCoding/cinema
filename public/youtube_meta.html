<!doctype html>
<html lang="en">

<head>
	<!-- ðŸ‘‹ðŸ‘‹ðŸ‘‹ Hello dear code reader, have fun understanding how YT works without ads. -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>YT Minimal Player (Metadata)</title>

	<link rel="dns-prefetch" href="//www.youtube.com">
	<link rel="dns-prefetch" href="//www.youtube-nocookie.com">
	<link rel="preconnect" href="https://www.youtube.com" crossorigin>
	<link rel="preconnect" href="https://www.youtube-nocookie.com" crossorigin>

	<style>
		html, body {
			margin: 0;
			padding: 0;
			width: 1px;
			height: 1px;
			overflow: hidden;
		}

		#player-container {
			width: 1px;
			height: 1px;
			position: fixed;
			top: 0;
			left: 0;
		}
	</style>
</head>

<body>
	<div id="player-container"></div>

	<script>
		// Get parameter from hash first, then fall back to query parameters
		function getParameter(name) {
			// Try hash parameters first
			const hash = window.location.hash.substring(1); // Remove '#'
			if (hash) {
				const hashParams = new URLSearchParams(hash);
				const hashValue = hashParams.get(name);
				if (hashValue) return hashValue;
			}

			// Fall back to query parameters for backwards compatibility
			const urlParams = new URLSearchParams(window.location.search);
			if (urlParams.get(name)) return urlParams.get(name);

			return null;
		}

		const tag = document.createElement('script');
		tag.src = "https://www.youtube.com/iframe_api";
		tag.onerror = function() {
			console.log("ERROR:Failed to load YouTube IFrame API");
		};
		document.head.appendChild(tag);

		let player = null;

		const defaultPlayerVars = {
			controls: 0,       // Hide native controls
			rel: 0,            // Disable related videos
			loop: 0,           // No loop
			disablekb: 1,      // Disable keyboard shortcuts
			enablejsapi: 1,    // Enable JS API for custom controls
			muted: 1,		   // Set to play muted
			cc_load_policy: 0, // Do not display subtitles automatically
			iv_load_policy: 3, // Do not display video annotations
			autoplay: 1		   // Set to make it autostart
		};

		function onYouTubeIframeAPIReady() {
			const vid = getParameter('v') || 'dQw4w9WgXcQ';

			createPlayer(vid);
		}

		function createPlayer(videoId) {
			if (player && typeof player.destroy === 'function') {
				player.destroy();
				player = null;
				document.getElementById('player-container').innerHTML = '';
			}

			player = new YT.Player('player-container', {
				height: '100%',
				width: '100%',
				videoId: videoId,
				playerVars: defaultPlayerVars,
				host: 'https://www.youtube-nocookie.com',
				events: {
					onReady: () => {
						player.playVideo();
						player.setVolume(0);

						// Wait 1.5 seconds for video to load and play
						setTimeout(() => {
							const videoData = player.getVideoData();
							const playerState = player.getPlayerState();
							const duration = player.getDuration();

							// Check if player is in playable state
							const isPlayable = playerState === YT.PlayerState.PLAYING ||
											playerState === YT.PlayerState.BUFFERING ||
											playerState === YT.PlayerState.CUED;

							// Determine video type based on actual playback data
							const isLive = isPlayable && videoData.isLive;
							const isNormalVideo = isPlayable && duration > 0 && !videoData.isLive;

							// Pause the video after metadata extraction
							player.pauseVideo();

							const metadata = {
								title: videoData.title,
								isLive: isLive,
								duration: Math.round(duration),
								debug: {
									playerState: playerState,
									videoType: isLive ? "live" : (isNormalVideo ? "normal" : "unknown"),
									videoData: videoData
								}
							};

							console.log("METADATA:" + JSON.stringify(metadata));
						}, 1500); // Wait 1.5 seconds
					},
					onError: (event) => {
						const YT_ERROR_CODES = {
							2: "Invalid parameter value (e.g. wrong video ID format).",
							5: "HTML5 player error â€“ the requested content cannot be played in this player.",
							100: "Video not found. It may have been removed, set to private, or the ID is invalid.",
							101: "The owner of the video has prohibited embedding on this site.",
							150: "Video is age-restricted or unplayable for unknown reasons." // Same as 101
						};

						console.log("ERROR:" + YT_ERROR_CODES[event.data]);
					}
				}
			});
		}

		/**
		 * Handle edge case if API already loaded
		 */
		if (window.YT && window.YT.Player && !player) {
			if (document.readyState === 'complete') {
				onYouTubeIframeAPIReady();
			} else {
				window.addEventListener('load', onYouTubeIframeAPIReady);
			}
		}

	</script>
</body>

</html>