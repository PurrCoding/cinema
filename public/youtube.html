<!doctype html>
<html lang="en">

<head>
	<!-- ðŸ‘‹ðŸ‘‹ðŸ‘‹ Hello dear code reader, have fun understanding how YT works without ads. -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>YT Minimal Player</title>

	<link rel="dns-prefetch" href="//www.youtube.com">
	<link rel="dns-prefetch" href="//www.youtube-nocookie.com">
	<link rel="preconnect" href="https://www.youtube.com" crossorigin>
	<link rel="preconnect" href="https://www.youtube-nocookie.com" crossorigin>

	<style>
		html, body {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
			overflow: hidden;
		}

		#player-container {
			width: 100%;
			height: 100%;
			position: fixed;
			top: 0;
			left: 0;
			background: #000000;
		}
	</style>
</head>

<body>
	<div id="player-container"></div>

	<script>
		function getUrlParameter(name) {
			const urlParams = new URLSearchParams(window.location.search);
			if (urlParams.get(name)) return urlParams.get(name);

			return null;
		}

		const tag = document.createElement('script');
		tag.src = "https://www.youtube.com/iframe_api";
		tag.onerror = function() {
			console.log("ERROR:Failed to load YouTube IFrame API");
		};
		document.head.appendChild(tag);

		let player = null;

		const defaultPlayerVars = {
			controls: 0,       // Hide native controls
			rel: 0,            // Disable related videos
			loop: 0,           // No loop
			disablekb: 1,      // Disable keyboard shortcuts
			modestbranding: 1, // Reduce branding
			enablejsapi: 1,    // Enable JS API for custom controls
			muted: 1,		   //Set to play muted
			autoplay: 1		   //Set to make it autostart
		};

		function onYouTubeIframeAPIReady() {
			const vid = getUrlParameter('v') || 'dQw4w9WgXcQ';
			const startTime = parseFloat(getUrlParameter('t')) || 0;

			createPlayer(vid, startTime);
		}

		function createPlayer(videoId, startTime) {
			if (player && typeof player.destroy === 'function') {
				player.destroy();
				player = null;
				document.getElementById('player-container').innerHTML = '';
			}

			player = new YT.Player('player-container', {
				height: '100%',
				width: '100%',
				videoId: videoId,
				playerVars: {
					...defaultPlayerVars,
					start: Math.floor(startTime)  // YouTube API supports start parameter
				},
				host: 'https://www.youtube-nocookie.com',
				events: {
					onReady: () => {
						wrapper._ready = true;

						// Additional seek if needed (for more precise timing)
						if (startTime > 0) {
							player.seekTo(startTime, true);
						}

						window.cinema_controller = wrapper;
						exTheater.controllerReady();
					},
					onStateChange: (e) => wrapper._paused = e.data !== YT.PlayerState.PLAYING
				}
			});

			const wrapper = {
				_ready: false,
				_paused: true,
				play() {
					if (this._ready) player.playVideo();
				},
				pause() {
					if (this._ready) player.pauseVideo();
				},

				get currentTime() {
					return this._ready ? player.getCurrentTime() : 0;
				},
				set currentTime(time) {
					if (this._ready) player.seekTo(time, true);
				},

				get volume() {
					return this._ready ? player.getVolume() / 100 : 1;
				},
				set volume(v) {
					if (this._ready) {
						if (player.isMuted()) {
							player.unMute();
						}

						player.setVolume(v * 100);
					}
				},

				get paused() {
					return this._paused;
				}
			};
		}

		/**
		 * Handle edge case if API already loaded
		 */
		if (window.YT && window.YT.Player && !player) {
			if (document.readyState === 'complete') {
				onYouTubeIframeAPIReady();
			} else {
				window.addEventListener('load', onYouTubeIframeAPIReady);
			}
		}

	</script>
</body>

</html>